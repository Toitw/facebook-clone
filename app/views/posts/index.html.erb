<!-- app/views/posts/index.html.erb -->
<h1>Welcome <%= current_user.name %></h1>

<h2>Timeline</h2>

<%= form_with(model: Post.create, url: posts_path, local: true) do |form| %>
  <%= form.text_field :content, placeholder: "What's on your mind?" %>
  <%= form.submit "Post" %>
<% end %>

<% if @posts.any? %>
  <% @posts.each do |post| %>
    <div class="post">
      <p><strong><%= post.user.name %></strong></p>
      <p><%= post.content %></p>

      <% if post.likes.any? %>
        <p>Likes: <%= post.likes.count %></p>
      <% end %>

      <% if post.comments.any? %>
        <p>Comments:</p>
        <ul>
          <% post.comments.each do |comment| %>
            <li><strong><%= comment.user.name %></strong>: <%= comment.content %></li>
            <%= button_to "Delete comment", comment_path(comment), method: :delete %>
          <% end %>
        </ul>
      <% end %>

      <%= form_with(model: Like.new, url: likes_path(post)) do |form| %>
        <%= form.hidden_field :post_id, value: post.id %>
        <%= form.submit "Like" %>
      <% end %>

      <%= form_with(model: Comment.new, url: comments_path(@comment)) do |form| %>
        <%= form.hidden_field :post_id, value: post.id %>
        <%= form.text_field :content, placeholder: "Add a comment..." %>
        <%= form.submit "Comment" %>
      <% end %>
    </div>
  <% end %>
<% else %>
  <p>No posts to show.</p>
<% end %>
